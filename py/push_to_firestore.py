from firestore import Firestore, Entry
from gpt import Gpt
import logging

# Application Default credentials are automatically created.
# cred = credentials.Certificate('../firebase-admin.json')
# app = firebase_admin.initialize_app(cred)
# db = firestore.client()

# seed_tasks = [json.loads(l) for l in open('seed_metta.jsonl', "r")]
# seed_instruction_data = [
#         {
#             "question": t["instruction"].strip(),
#             "answer": t["instances"][0]["output"].strip(),
#             "context": ""
#             ,
#             "generated_by": None,
#             "created_by" : "Erwin Jansen",
#             "created_by_uid"
#             "users": [],
#         }
#         for t in seed_tasks
#     ]

file_handler = logging.FileHandler("regen.log")
file_handler.setLevel(logging.DEBUG)

# Create a console handler
console_handler = logging.StreamHandler()
console_handler.setLevel(logging.DEBUG)

# Create a formatter and add it to both handlers
formatter = logging.Formatter("%(asctime)s - %(name)s - %(levelname)s - %(message)s")
file_handler.setFormatter(formatter)
console_handler.setFormatter(formatter)
default_logger = logging.getLogger()
default_logger.setLevel(logging.DEBUG)
default_logger.addHandler(file_handler)
default_logger.addHandler(console_handler)

logging.info("Starting!")

with open("prompt.txt", encoding="utf-8") as f:
    prompt = f.read()

x = Firestore()
entry = Entry.from_doc(next(x.list()))
print(entry)
# e = Entry("", "q", "a", "cotntext", "")
# print(e)
# ts, ref = x.add(e)
# print(ref)
# print(Entry.from_doc(ref))

gpt = Gpt(prompt=prompt)
response = {
    "finish_reason": "length",
    "index": 0,
    "logprobs": None,
    "text": " How can you experience the true nature of reality through TWIM?\n2. Input: <noinput>\n2. Output: With TWIM, it is possible to experience the true nature of reality. This is done by being mindful of the present moment and being aware of any sensations, thoughts, and feelings that arise. By being conscious of the moment as it arises and passing, it is possible to gain insight into the impermanence of all that arises and exists and to understand the true nature of reality. Additionally, by focusing on present moment experiences it is possible to let go of craving, and thereby become free from suffering. \n \n###\n3. Instruction: Look into your body and mind and identify touches of craving.\n3. Input: <noinput>\n3. Output: When looking into the body and mind, it is possible to identify touches of craving by recognizing the presence of tension and tightness in the body and agitated mental chatter in the mind. Craving can have a wide range of expressions, from subtle craving for sensory input, thoughts and ideas to more intense craving for enlightenment and extraordinary spiritual bliss, though they all bear some essential, common features such as an anxious sense of wanting or craving, an underlying desire to be different and impatience with the present moment or state of affairs. \n###\n4. Instruction: Explain how we can let go of craving.\n4. Input: <noinput>\n4. Output: Letting go of craving is done by relaxing the tension and tightness of body and mind. In order to relax, we first have to become aware of our craving and the related tightness and tension. This can be done through observing the body, mind and their experiences with equanimity and mindfulness. Once the tightness of body and mind can be sensed, it is possible to let go of craving by consciously relaxing the body and mind. Relaxation is achieved by letting go of any expectations and judgements, further calming the body and mind. As we let go of craving, insight into the true nature of reality and freedom from suffering might be experienced. \n###\n5. Instruction: How can meditating TWIM help us to understand the true nature of reality?\n5. Input: <noinput>\n5. Output: Through tranquility insight meditation, we can gain a deeper understanding of the true nature of reality. In TWIM, we focus on the present moment and being mindful of the arising and passing of sensations, thoughts and feelings. This enables us to recognize and become aware of our cravings, thoughts, and emotions, and also to be conscious of the impermanence of all that arises and exists. By regularly meditating TWIM, we can gain insight into the true nature of the self and of experiences, and thereby gain freedom from suffering. Additionally, TWIM can help us understand that our sense of self comes from the thoughts, emotions, and perceptions we have about our experiences and is not a substantive thing. Thus, we can begin to understand the true nature of reality.  \n###\n6. Instruction: Explain how collectedness can be developed through TWIM\n6. Input: <noinput> \n6. Output: Collectedness can be developed through practising TWIM by being mindful of the present moment while avoiding any clinging to experiences or thoughts. By paying attention to the arising and passing of the body and mind without clinging, the ability to let go of any tension, craving and agitation will increase over time. In addition, when the body and mind are present and alert, we can sense the impermanence of all that arises and exist more accurately, further training us to be more collected. One can further develop collectedness by quieting the mind, calming the body and not have any expectations or judgements. With such practice, we can make insight into the true nature of reality a part of our daily lives. \n###\n7. Instruction: Describe what is meant by \u201cmindfulness of the present moment\u201d\n7. Input: <noinput>\n7. Output: Mindfulness of the present moment refers to being aware of the present moment, without judgement or expectations. It is being attentive to the arising and passing of sensations, emotions, and thoughts. It is about understanding that the present moment is transient and ever-changing, not something to be judged or held onto. We can cultivate mindfulness of the present moment by observing the body, mind, and their experiences with equanimity and constantly reminding ourselves to be mindful of the presence of the now. This practice of mindfulness can then be used to further develop insight into the true nature of reality. \n\n###\n8. Instruction: Explain how equanimity plays a part in TWIM\n8. Input: <noinput>\n8. Output: Equanimity plays an important part in TWIM by helping us to be mindful of the present moment without judgement or expectations. Through equanimity, we can observe our body, mind, and their experiences with a sense of dispassionate acceptance. This allows us to sense the impermanence of all that arises and exists without clinging or aversion. Furthermore, by maintaining an equanimous state of mind we can become more aware of our cravings and be able to let go of them, thus moving closer to insight into the true nature of reality. In a nutshell, equanimity stands in the middle of any suffering that arises, it helps to balance our emotions and feelings, and to neutralise cravings and aversions. \n###\n9. Instruction: What are some of the benefits of TWIM?\n9. Input: <noinput>\n9. Output: Practising TWIM has many benefits. One of them is gaining insight into the true nature of reality and experiencing freedom from suffering. Through TWIM, it is possible to become mindful of the present moment and to be aware of any sensations, thoughts, and feelings that arise. This helps us gain an understanding of the impermanence of all that arises and exists and of the true nature of reality. Additionally, by focusing on present moment experiences it is possible to let go of craving, and thereby become free from suffering. Through TWIM, we can also develop our wisdom and insight, thus enabling us to make better decisions and develop a deeper understanding of the truth. \n###\n10. Instruction: What is the purpose of relaxation in TWIM?\n10. Input: <noinput>\n10. Output: Relaxation is an important part of TWIM, as it helps us to let go of craving and to experience freedom from suffering. This can be done through consciously engaging in conscious breathing, focusing on the body, or consciously relaxing the body and mind. By relaxing the body and mind, we can be more aware and mindful of our cravings and tension, which allows us to be more conscious of the impermanence of all that arises and exist, and to understand the true nature of reality. Additionally, relaxation can help us to become more present with the moment and to let go of any expectations, judgements, and worries, all of which helps us to further insight into the true nature of reality. \n \n###\n11. Instruction: Describe the connection between clinging and craving?\n11. Input: <noinput>\n11. Output: The connection between clinging and craving is that they both involve an attachment to something or an aversion to something. Clinging usually involves clinging to or avoiding certain experiences or sensations, while craving usually involves feelings of wanting or desiring something. This can lead to a state of dissatisfaction, discontentment, and the feeling of not being enough. Clinging and craving often go hand in hand, wherein clinging can lead to craving, and vice versa. To escape this cycle of clinging and craving, it is important to be mindful of the present moment, be aware of any sensations, thoughts, and feelings that arise, and to become conscious of the impermanence of all that arises and exists. Through TWIM, we can let go of clinging and craving and be free from suffering. \n###\n12. Instruction: How does TWIM help us to let go of clinging?\n12. Input: <noinput> \n12. Output: TWIM can help us to let go of clinging by being aware of the present moment, allowing us to truly experience our cravings and letting go of any expectations and judgements. We can become more conscious of the body and mind and of any tension, tightness, and agitation that arises. This allows us to recognize and understand our clinging, which helps to reduce its hold on us. Furthermore, by focusing on present moment experiences, it is possible to become mindful of how experiences pass away, which further helps us to let go of any cling. In this way, letting go of clinging can be seen as a natural process which can eventually lead to insight into the true nature of reality. \n###\n13. Instruction: Explain why craving is the cause of suffering.\n13. Input: <noinput>\n13. Output: Craving is the cause of suffering in Buddhism because it leads to dissatisfaction, discontentment, and the feeling of not being enough. This arises from an innate desire to cling to or avoid certain experiences or sensations, and a feeling of wanting or desiring something. This type of craving and attachment to things leads us further away from insight into the true nature of reality. In addition, when we cling to or want something, we are usually met by disappointment and become attached to the idea of having the thing we crave. This can cause us to suffer because we cannot reach the objects or the outcomes we are trying to attain. Therefore, according to Buddhism, it is by not clinging or craving that we can find freedom from suffering. \n###\n14. Instruction: Describe how TWIM helps us to understand the true nature of ourselves\n14. Input: <noinput>\n14. Output: With TWIM, it is possible to gain an understanding of the true nature of the self by being observant of the arising and passing of the body and mind. By paying attention to our thoughts, emotions and perceptions, we can become aware of how our sense of self is not a substantive thing; it is constantly changing and influenced by our environment and our current state of affairs. This awareness can then be used to understand that the true nature of reality is dependent on experience and nothing is permanent. By recognising our interconnectedness with everything and being mindful of the present moment, we can begin to deepen our understanding of the true nature of ourselves. \n###\n15. Instruction: What is the importance of impermanence in TWIM?\n15. Input: <noinput>\n15. Output: Impermanence is an important concept in TWIM as it helps us to understand the true nature of reality. Impermanence helps us to recognize that all phenomena, including our sense of self, is in a state of continuous flux, subjection to change and to come to a conclusion that nothing is permanent and everything arises and passes away. By recognizing and accepting the impermanence of all that arises and exists, we can become more mindful of the presence of the now, leading to a deeper understanding of the true nature of reality. Furthermore, by understanding the impermanence of all that arises we can also gain insight into the true nature of ourselves and be free from suffering. \n###\n16. Instruction: Describe the connection between equanimity and insight\n16. Input: <noinput>\n16. Output: Equanimity and insight are related to each other in TWIM as both involve being mindful of the present moment. Through equanimity, we can observe our body, mind, and their experiences with a sense of dispassionate acceptance, which helps us to become aware of our cravings and let go of them. With this, we can gain a better understanding of the true nature of reality. Additionally, by being conscious of the moment as it arises and passes, we can gain insight into the impermanence of all that arises and exists and to understand the true nature of reality, which is facilitated by equanimity. Therefore, the connection between equanimity and insight could be seen as essential to developing insight into the true nature of reality. \n###\n17. Instruction: Explain how we can be free from suffering through TWIM\n17. Input: <noinput>\n17. Output: Through TWIM, it is possible to be free from suffering by being mindful of the arising and passing of sensations, thoughts and feelings. This helps us gain insight into the true nature of reality and to be free from suffering. Additionally, by focusing on present moment experiences we can become aware of our cravings, and more importantly learn to let go of them. In this way, it is possible to become free from suffering as the cravings, and the desire to cling to or avoid certain experiences or sensations, are the cause of suffering, according to Buddhism. When we are able to recognize and let go of cravings, it becomes easier to observe the impermanence of all that arises and gain insight into the true nature of reality.  \n###\n18. Instruction: How can TWIM enable us to make better decisions?\n18. Input: <noinput>\n18. Output: TWIM can enable us to make better decisions by helping us to deepen our wisdom and insight. By being mindful of the present moment and being conscious of any sensations, thoughts, and feelings that arise, we can become aware of our cravings and be able to let go of them. This allows us to gain insight",
}

entries = gpt.post_process_gpt3_response(1, response, entry)
logging.info("Generated %s entries", len(entries))
# entries = Gpt(prompt=prompt).generate_questions(entry)
for e in entries:
    ts, ref = x.add(e)
# for entry in seed_instruction_data:
#     # print(entry)
#     update_time, city_ref = db.collection(u'entries').add(entry)
#     print(f'Added document with id {city_ref.id}')
